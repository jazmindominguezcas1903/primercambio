<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Campo Direccional – Flujo en Fibra Óptica</title>

<style>
    body {
        font-family: "Segoe UI", sans-serif;
        margin: 0;
        background: #0f172a;
        color: #e2e8f0;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    header {
        width: 100%;
        padding: 20px;
        text-align: center;
        background: #1e293b;
        box-shadow: 0 4px 10px #00000040;
    }

    h1 {
        margin: 0;
        font-size: 28px;
        color: #38bdf8;
    }

    #canvasBox {
        margin-top: 20px;
        background: #1e293b;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 0 20px #00000060;
    }

    canvas {
        border-radius: 10px;
        background: #0f172a;
    }

    .params-box {
        margin-top: 20px;
        padding: 15px;
        background: #1e293b;
        border-radius: 10px;
        width: 90%;
        max-width: 700px;
        box-shadow: 0 0 15px #00000050;
    }

    .params-box label {
        display: block;
        margin-bottom: 6px;
        margin-top: 10px;
        color: #38bdf8;
        font-weight: bold;
    }

    input[type="number"] {
        width: 100%;
        padding: 8px;
        border-radius: 6px;
        background: #0f172a;
        border: 1px solid #475569;
        color: #e2e8f0;
    }

    button {
        margin-top: 15px;
        width: 100%;
        padding: 12px;
        border: none;
        background: #38bdf8;
        color: #0f172a;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
    }

    button:hover {
        background: #0ea5e9;
    }
</style>
</head>

<body>

<header>
    <h1>Campo Direccional de Flujo de Datos – Fibra Óptica</h1>
</header>

<div id="canvasBox">
    <canvas id="campo" width="700" height="500"></canvas>
</div>

<div class="params-box">
    <h2>Parámetros del Modelo</h2>

    <label>Atenuación del Backbone (a):</label>
    <input type="number" id="a" value="1" step="0.1">

    <label>Atenuación de Nodos (B):</label>
    <input type="number" id="B" value="2" step="0.1">

    <label>Fuerza Base R0:</label>
    <input type="number" id="R0" value="5" step="0.5">

    <button onclick="dibujarCampo()">Actualizar Campo</button>
</div>

<script>
// -------------------------------------------------------------
// PARÁMETROS Y NODOS
// -------------------------------------------------------------
let nodos = [
    { x: -2, y: -1, G: 4 },
    { x:  2, y:  1, G: 3 },
    { x:  4, y: -2, G: 2 }
];

// -------------------------------------------------------------
// FUNCIÓN R(x, y)
// -------------------------------------------------------------
function R(x, y, a, B, R0) {
    let d_backbone = Math.abs(y);
    let valor = R0 * Math.exp(-a * d_backbone);

    for (let n of nodos) {
        let d = Math.hypot(x - n.x, y - n.y);
        valor += n.G * Math.exp(-B * d);
    }
    return valor;
}

// -------------------------------------------------------------
// GRADIENTE numérico
// -------------------------------------------------------------
function gradiente(x, y, a, B, R0) {
    let h = 0.05;
    let dRdx = (R(x + h, y, a, B, R0) - R(x - h, y, a, B, R0)) / (2 * h);
    let dRdy = (R(x, y + h, a, B, R0) - R(x, y - h, a, B, R0)) / (2 * h);
    return { dx: dRdx, dy: dRdy };
}

// -------------------------------------------------------------
// DIBUJAR CAMPO DIRECCIONAL
// -------------------------------------------------------------
function dibujarCampo() {
    let canvas = document.getElementById("campo");
    let ctx = canvas.getContext("2d");

    let a = parseFloat(document.getElementById("a").value);
    let B = parseFloat(document.getElementById("B").value);
    let R0 = parseFloat(document.getElementById("R0").value);

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    let W = canvas.width;
    let H = canvas.height;

    // convertir px a coords matemáticas
    function mapX(px) { return (px / W) * 12 - 6; }
    function mapY(py) { return (py / H) * 10 - 5; }

    // ---------------------------------------------------------
    // Colorear campo de R
    // ---------------------------------------------------------
    for (let px = 0; px < W; px += 3) {
        for (let py = 0; py < H; py += 3) {
            let x = mapX(px);
            let y = mapY(py);
            let val = R(x, y, a, B, R0);

            // normalizar color
            let c = Math.min(1, val / 10);
            ctx.fillStyle = `rgb(${c * 50}, ${c * 150}, ${c * 255})`;
            ctx.fillRect(px, py, 3, 3);
        }
    }

    // ---------------------------------------------------------
    // Dibujar campo direccional (flechas del gradiente)
    // ---------------------------------------------------------
    ctx.strokeStyle = "white";

    for (let px = 0; px < W; px += 40) {
        for (let py = 0; py < H; py += 40) {

            let x = mapX(px);
            let y = mapY(py);
            let g = gradiente(x, y, a, B, R0);

            let vx = g.dx * 0.4;
            let vy = g.dy * 0.4;

            ctx.beginPath();
            ctx.moveTo(px, py);
            ctx.lineTo(px + vx * 10, py - vy * 10);
            ctx.stroke();
        }
    }

    // ---------------------------------------------------------
    // Dibujar nodos emisores
    // ---------------------------------------------------------
    ctx.fillStyle = "#ffcc00";
    for (let n of nodos) {
        let px = ((n.x + 6) / 12) * W;
        let py = ((n.y + 5) / 10) * H;

        ctx.beginPath();
        ctx.arc(px, py, 7, 0, Math.PI * 2);
        ctx.fill();

        ctx.fillStyle = "white";
        ctx.fillText(`G=${n.G}`, px + 10, py - 10);
        ctx.fillStyle = "#ffcc00";
    }

    // ---------------------------------------------------------
    // Backbone (y=0)
    // ---------------------------------------------------------
    ctx.strokeStyle = "cyan";
    let py0 = ((0 + 5) / 10) * H;
    ctx.beginPath();
    ctx.moveTo(0, py0);
    ctx.lineTo(W, py0);
    ctx.stroke();
}
  
// Dibujar al cargar
dibujarCampo();
</script>

</body>
</html>
